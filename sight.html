<!DOCTYPE html>
<head>
	<link rel="stylesheet" href="sight.css">
	<nav class="naviBar">
		<a id="btn1" class="left" onclick="btnClick()">Button1</a>
		<a id="btn2" class="left" onclick="createItem()">Btn2</a>
		<a class="seperator"></a>
		<a id="btn3" class="right" onclick="createCat()">BTN03</a>
		<!--input class="searchBar" placeholder="Search..."-->
		<!--div id="submit" class="submitButton" onclick="test()"-->
		<a id="btn4" class="right" onclick="addCategoryForm()">+</a>
	</nav>
	<script>
		function btnClick() {
			const a = document.createElement("p");
			a.textContent = "button press";
			document.getElementById("content").appendChild(a);
		}
		function createItemOld() {
			const newItem = document.createElement("div");
			newItem.className = "item";

			const itemTitle = document.createElement("a");
			itemTitle.className = "itemTitle";
			const itemDesc = document.createElement("a");
			itemDesc.className = "desc";

			newItem.appendChild(itemTitle);
			newItem.appendChild(itemDesc);

			document.getElementById("content").appendChild(newItem);
		}

		function createCat() {
			const newCat = document.createElement("div");
			newCat.className = "category";

			const newCatTitle = document.createElement("a");
			newCatTitle.text = "fhjnkdshnfgkjadhngkd";
			newCatTitle.className = "catTitle";

			const newItem = document.createElement("div");
			newItem.className = "item itemGray";

			const itemTitle = document.createElement("a");
			itemTitle.className = "itemTitle";
			itemTitle.text = "jfiodasjfgojgo";
			const itemDesc = document.createElement("a");
			itemDesc.text = "fjkidklajglas";
			itemDesc.className = "desc";

			newItem.appendChild(itemTitle);

			newItem.appendChild(itemDesc);

			newCat.append(newCatTitle);
			newCat.append(newItem);

			// add line seperator
			const lineSeperator = document.createElement("hr");
			lineSeperator.className = "seperator";

			
			const container = document.getElementById("content");
			container.appendChild(newCat);
			container.appendChild(lineSeperator);
		}
		
		function hideForm(elem) {
			document.body.removeChild(elem);
		}
		
		function addCategoryForm() {
			const background = document.createElement("div");
			background.className = "addCatFormPopupBackground";
			document.body.appendChild(background);
			document.body.style.overflow = "hidden";

			background.addEventListener("click", function() {
				document.body.removeChild(background);
				document.body.removeChild(form);
				document.body.style.overflow = "auto";
			});

			const form = document.createElement("div");
			form.className = "addCatFormPopup";
			document.body.appendChild(form);

			const createCatBtn = document.createElement("a");
			createCatBtn.className = addBtn;
			createCatBtn.text = "+";

			document.getElementById("content").appendChild(createCatBtn);

		}

		function closeAddForm() {

		}

		// sep

		function dropdownCatAddForm(btnContainer) {
			// const container = document.getElementById("content");
			const element = document.querySelector(".addCatFormContainer");

			// remove plus icon
			const plusIcon = document.body.querySelector(".plus");
			btnContainer.removeChild(plusIcon);

			// resize btn
			btnContainer.classList.toggle("addCatFormContainerExpanded");

			setTimeout(function(){
				// add title?
				const formTitle = document.createElement("a");
				formTitle.className = "addCatFormTitle";
				formTitle.text = "Create category";

				// change styling for consistancy?
				const closeBtn = document.createElement("a");
				closeBtn.className = "closeBtn";
				closeBtn.text = "";

				// cat form
				const catNameInput = document.createElement("input");
				catNameInput.className = "catNameInput";
				catNameInput.type = "text";
				catNameInput.name = "catName";
				catNameInput.placeholder = "Enter the name of the category";

				const catDescInput = document.createElement("input");
				catDescInput.className = "catNameInput";
				catDescInput.type = "text";
				catDescInput.name = "catName";
				catDescInput.placeholder = "Enter a description for the category. (Optional)";

				const catNameSubmit = document.createElement("input");
				catNameSubmit.className = "catNameSubmitButton";
				catNameSubmit.type = "submit";
				catNameSubmit.value = "";

				catNameSubmit.addEventListener("click", function() {
					if (catNameInput.value) {
						createCategory(catNameInput.value, catDescInput.value);
						appendCatAddBtn();
					} else {
						catNameInput.focus();
					}					
				});

				const closeFormBtn = document.createElement("div");
				closeFormBtn.className = "catNameSubmitButton";
				closeFormBtn.value = "X";

				closeFormBtn.addEventListener("click", function() {
					appendCatAddBtn();
				});

				// append to doc
				btnContainer.appendChild(catNameInput);
				btnContainer.appendChild(catDescInput);
				btnContainer.appendChild(closeFormBtn);
				btnContainer.appendChild(catNameSubmit);

				// focus on input field to allow input from btn press
				catNameInput.focus();
			}, 100)

		}

		function dropdownCatAddFormAlt(btnContainer) {
			const container = document.getElementById("content");

			// remove button
			container.removeChild(btnContainer);

			// form container
			const formContainer = document.createElement("div");
			formContainer.className = "addCatFormContainer";

			const formTitle = document.createElement("a");
			formTitle.className = "addCatFormTitle";
			formTitle.text = "Create category";

				// to remove
			const closeBtn = document.createElement("a");
			closeBtn.className = "closeBtn";
			closeBtn.text = "X";

			const catNameInput = document.createElement("input");
			catNameInput.className = "catNameInput";
			const catNameSubmit = document.createElement("div");
			catNameSubmit.className = "catNameSubmitButton";

			// append to doc
			formContainer.append(formTitle);
			formContainer.append(closeBtn);
			formContainer.appendChild(catNameInput);
			formContainer.appendChild(catNameSubmit);
			container.appendChild(formContainer);
		}


		function appendOptionsBar(container) {
			const optionsBar = document.createElement("div");
			optionsBar.className = "optionsBar";

			const plusBtn = document.createElement('img');
			plusBtn.src = 'assets/plus.svg';
			plusBtn.alt = 'SVG Image';
			plusBtn.className = "plusBtn";

			optionsBar.appendChild(plusBtn);

			container.append(optionsBar);

			return {
				add: plusBtn
				//edit: 
			}
		}

		function appendCatAddBtn() {
			const contentContainer = document.getElementById("content");

			// re-place the add category btn so that it appears after the other elements
			const catFormContainer = document.body.querySelector(".addCatFormContainer");
			if (catFormContainer != null) {
				contentContainer.removeChild(catFormContainer);
			}		

			const btnContainer = document.createElement("div");
			btnContainer.className = "addCatFormContainer";
			btnContainer.addEventListener("click", function() {
				dropdownCatAddForm(btnContainer)
			});

			const plusIcon = document.createElement("a");
			plusIcon.className = "plus";
			plusIcon.textContent = "+";

			btnContainer.appendChild(plusIcon);
			contentContainer.appendChild(btnContainer);
		}

		function appendDesc(container, desc) {
			if (desc == "") { return; }

			const lineSeperator = document.createElement("hr");
			lineSeperator.className = "titleSeperator";

			const descElement = document.createElement("a");
			descElement.className = "desc";
			descElement.textContent = desc;

			container.appendChild(lineSeperator);
			container.appendChild(descElement);

			return descElement;
		}

		function createCategory(title, desc) {

			const cat = document.createElement("div");
			cat.className = "category";

			const catTitle = document.createElement("a");
			catTitle.text = title;
			catTitle.className = "catTitle";

			cat.append(catTitle);

			const plusBtn = document.createElement('img');
			plusBtn.src = 'assets/plus.svg';
			plusBtn.alt = 'SVG Image';
			plusBtn.className = "plusBtn";

			cat.appendChild(plusBtn);

			const optionsBar = appendOptionsBar(cat);

			appendDesc(cat, desc);

			// add line seperator
			const lineSeperator = document.createElement("hr");
			lineSeperator.className = "seperator";
			
			const contentContainer = document.getElementById("content");
			contentContainer.appendChild(cat);
			contentContainer.appendChild(lineSeperator);

			createItemInput(cat, optionsBar.add, 0);

		}

		// adds listeners to click event and creates and formats item form element
		function createItemInput(element, listenerElement, layer) {
			// check if element is pressed
			listenerElement.addEventListener("click", function(event) {
				// run code if the item form does not already exist
				if (element.querySelector(".newIteminput") != null) { return; }
				// check if the element thats clicked is the element only
				if (event.target === listenerElement) { 
					const newItemContainer = document.createElement("div");
					newItemContainer.className = "newItemContainer";

					const newItemTitle = document.createElement("input");
					newItemTitle.type = "text";
					newItemTitle.placeholder = "Enter the name of the item";
					newItemTitle.className = "newIteminput";

					const newItemDesc = document.createElement("input");
					newItemDesc.type = "text";
					newItemDesc.placeholder = "Enter a description for the item. (Optional)";
					newItemDesc.className = "newIteminput";

					const newItemColor = document.createElement("input");
					newItemColor.type = "text";
					newItemColor.placeholder = "Enter the color of the item. (Optional)";
					newItemColor.className = "newIteminput";

					const cancelBtn = document.createElement("input");
					cancelBtn.type = "button";
					cancelBtn.className = "newitemFormBtn";
					cancelBtn.value = "Cancel";

					const catNameSubmit = document.createElement("input");
					catNameSubmit.type = "button";
					catNameSubmit.className = "newitemFormBtn";
					catNameSubmit.value = "Add";
					
					newItemContainer.appendChild(newItemTitle);
					newItemContainer.appendChild(newItemDesc);
					newItemContainer.appendChild(newItemColor);
					newItemContainer.appendChild(cancelBtn);
					newItemContainer.appendChild(catNameSubmit);
					element.appendChild(newItemContainer);

					// element.classList.toggle("newItemContainerExpanded");

					newItemTitle.focus();

					newItemContainer.addEventListener("keyup", function(event) {
						// if input is not enter, return
						if (event.key != 'Enter') { return; }
						if (event.key === 'Escape') { return; } // todo

						// run code below if new title value is not empty
						if (newItemTitle.value != "") {
							const newLayer = parseInt(layer + 1);
							const newItem = createItem(element, newItemTitle.value, newItemDesc.value, newLayer, "test");
							createItemInput(newItem.container, newItem.createItemBtn, newLayer);

							element.removeChild(newItemContainer);
							return;
						}
						newItemTitle.focus();
					});

					catNameSubmit.addEventListener("click", function() {
						// run code below if new title value is not empty
						if (newItemTitle.value != "") {
							const newLayer = parseInt(layer + 1);
							const newItem = createItem(element, newItemTitle.value, newItemDesc.value, newLayer, "test");
							createItemInput(newItem.container, newItem.createItemBtn, newLayer);

							element.removeChild(newItemContainer);
							return;
						}
						newItemTitle.focus();
					});

					cancelBtn.addEventListener("click", function() {
						element.removeChild(newItemContainer);
					});
				}
			});
		}


		// create item
		function createItem(parentDiv, title, desc, layer, color) {
			const itemContainer = document.createElement("div");

			// use whether the layer is odd or not to decide the class to use
			const layerOdd = layer % 2;
			console.log(layerOdd);
			if (layerOdd == 1) {
				itemContainer.className = "item itemWhite";
			} else {
				itemContainer.className = "item itemGray";
			}

			const itemTitle = document.createElement("a");
			itemTitle.className = "itemTitle";
			itemTitle.textContent = title;

			itemContainer.appendChild(itemTitle);

			const optionsBar = appendOptionsBar(itemContainer);

			if (desc != "") {
				const lineSeperator = document.createElement("hr");
				lineSeperator.className = "titleSeperator";

				const itemDesc = document.createElement("a");
				itemDesc.className = "itemDesc";
				itemDesc.textContent = desc;

				itemContainer.appendChild(lineSeperator);
				itemContainer.appendChild(itemDesc);
			}

			parentDiv.appendChild(itemContainer);
			return {
				container: itemContainer,
				createItemBtn: optionsBar.add
			};
		}
		
	</script>
	<div id="content" class="contentContainer">
		<!--div id="test" class="category">
			<a class="catTitle">Category 1</a>
			<div class="item itemGray">
				<a class="itemTitle">dhjsafgjadsgfjasdk</a>
				<a class="itemTitle">Item title 1</a>
				<a class="itemDesc">This is the items description</a>
				<div class="itemCloseBtn">X</div>
			</div>
		</div>
		<hr class="seperator">
		<div class="category">
			<a class="catTitle">Category 2</a>
			<div class="item itemGray">
				<a class="itemTitle">Item title 2</a>
				<hr class="titleSeperator">
				<a class="desc">This is the items description</a>
				<div class="item itemWhite">
					<a class="itemTitle">Item title 1 layer 2</a>
					<hr class="titleSeperator">
					<a class="desc">This <br> is the items <br> description</a>
				</div>
				<div class="item itemWhite">
					<a class="itemTitle">Item title 3</a>
					<hr class="titleSeperator">
					<a class="desc">Item 3 description</a>
					<div class="item itemGray">
						<a class="itemTitle">Item title 1 layer 2</a>
						<hr class="titleSeperator">
						<a class="desc">This <br> is the items <br> description</a>
						<div class="item itemWhite">
							<a class="itemTitle">Item title 1 layer 2</a>
							<hr class="titleSeperator">
							<a class="desc">This <br> is the items <br> description</a>
						</div>
					</div>
				</div>
				<div class="item itemWhite">
					<a class="itemTitle">Item title 4</a>
					<hr class="titleSeperator">
					<a class="desc">Item 4 description</a>
				</div>
			</div>
			<div class="item itemGray">
				<a class="itemTitle">Item title 4</a>
			</div>
			<div class="item itemGray">
				<a class="itemTitle">Item title 5</a>
			</div>
		</div-->
	</div>
	<script>
		appendCatAddBtn();
		appendOptionsBar();
	</script>
</head>
